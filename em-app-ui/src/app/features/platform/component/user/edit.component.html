<div class="main-container user-edit-container">

  <!-- Header -->
  <div class="main-header">
    <h1 class="title">
      <mat-icon mat-card-avatar>person</mat-icon>
      @if (isCreateMode) { <span>Create User</span> }
      @if (isEditMode) { <span>Edit User</span> }
      @if (isViewMode) { <span>View User</span> }
    </h1>

    <div class="header-actions">
      <button mat-raised-button (click)="onBack()" type="button">
        <mat-icon>arrow_back</mat-icon>Back
      </button>

      @if(showCancelButton){
      <button mat-raised-button color="primary" (click)="onCancel()">
        <mat-icon>cancel</mat-icon>
        Cancel
      </button>
      }

      @if(showSaveButton){
      <button mat-raised-button color="primary" (click)="onSave()" [disabled]="pageData.loading() || isInvalidForm">
        <mat-icon>save</mat-icon>
        Save
      </button>
      }

      @if(showCreateButton){
      <button mat-raised-button color="primary" (click)="onCreate()" [disabled]="pageData.loading()">
        <mat-icon>add</mat-icon>
        Create
      </button>
      }

      @if(showEditButton){
      <button mat-raised-button color="primary" (click)="onEdit()" [disabled]="pageData.loading()">
        <mat-icon>edit</mat-icon>
        Edit
      </button>
      }

      @if(showDuplicateButton){
      <button mat-raised-button color="accent" (click)="onDuplicate()" [disabled]="pageData.loading()">
        <mat-icon>content_copy</mat-icon>
        Duplicate
      </button>
      }

      @if(showDeleteButton){
      <button mat-raised-button color="warn" (click)="onDelete()" [disabled]="pageData.loading()">
        <mat-icon>delete</mat-icon>
        Delete
      </button>
      }

      @if(showChangeStatusButton){
      <button mat-raised-button (click)="onChangeStatus()" type="button">
        <mat-icon>swap_horiz</mat-icon>Change Status
      </button>
      }
    </div>
  </div>

  <app-message [pageData]="pageData"></app-message>

  <app-loading [pageData]="pageData"></app-loading>
  
  @if (!pageData.loading()) {

  <!-- Section 1: User Details -->
  <mat-card class="form-section">
    <mat-card-header>
      <mat-card-title>User Details</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <form [formGroup]="mainForm" class="user-form">
        <div class="form-row">
          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Username</mat-label>
            <input matInput formControlName="username" placeholder="Enter username">
            @if(mainForm.get('username')?.hasError('required')) {
            <mat-error>Username is required</mat-error>
            }
          </mat-form-field>

          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Username Type</mat-label>
            <mat-select formControlName="usernameType">
              <mat-option [value]="UsernameTypeLvo.BASIC">BASIC</mat-option>
              <mat-option [value]="UsernameTypeLvo.EMAIL">EMAIL</mat-option>
              <mat-option [value]="UsernameTypeLvo.PHONE">PHONE</mat-option>
            </mat-select>
            @if(mainForm.get('usernameType')?.hasError('required')) {
            <mat-error>Username type is required</mat-error>
            }
          </mat-form-field>
        </div>

        @if(isCreateMode) {
        <div class="form-row">
          <mat-form-field appearance="outline" class="form-field full-width">
            <mat-label>Password</mat-label>
            <input matInput type="password" formControlName="password" placeholder="Enter password">
          </mat-form-field>
        </div>
        }

        <div class="form-row">
          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Status</mat-label>
            <mat-select formControlName="status">
              <mat-option [value]="UserStatusLvo.ACTIVE">ACTIVE</mat-option>
              <mat-option [value]="UserStatusLvo.BLOCKED">BLOCKED</mat-option>
            </mat-select>
            @if(mainForm.get('status')?.hasError('required')) {
            <mat-error>Status is required</mat-error>
            }
          </mat-form-field>

          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Holder Type</mat-label>
            <mat-select formControlName="ownerType">
              <mat-option [value]="OwnerTypeLvo.ACCOUNT">ACCOUNT</mat-option>
              <mat-option [value]="OwnerTypeLvo.CORPORATE">CORPORATE</mat-option>
            </mat-select>
            @if(mainForm.get('ownerType')?.hasError('required')) {
            <mat-error>Holder type is required</mat-error>
            }
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Provider</mat-label>
            <input matInput formControlName="provider" placeholder="Enter provider">
          </mat-form-field>

          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Picture URL</mat-label>
            <input matInput formControlName="picture" placeholder="Enter picture URL">
          </mat-form-field>
        </div>
      </form>
    </mat-card-content>
  </mat-card>

  <!-- Section 2: Contact Details -->
  <mat-card class="form-section">
    <mat-card-header>
      <mat-card-title>Contact Details</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <form [formGroup]="contactForm" class="contact-form">
        <div class="form-row">
          <mat-form-field appearance="outline" class="form-field">
            <mat-label>First Name</mat-label>
            <input matInput formControlName="firstName" placeholder="Enter first name">
            @if(contactForm.get('firstName')?.hasError('required')) {
            <mat-error>First name is required</mat-error>
            }
          </mat-form-field>

          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Last Name</mat-label>
            <input matInput formControlName="lastName" placeholder="Enter last name">
            @if(contactForm.get('lastName')?.hasError('required')) {
            <mat-error>Last name is required</mat-error>
            }
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline" class="form-field full-width">
            <mat-label>Birth Date</mat-label>
            <input matInput formControlName="birthDate" type="date" placeholder="Enter birth date">
          </mat-form-field>
        </div>
      </form>

      <form [formGroup]="defaultEmailForm" class="contact-form">
        <div class="form-row">
          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Email</mat-label>
            <input matInput formControlName="email" placeholder="Enter email">
          </mat-form-field>

          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Email Type</mat-label>
            <mat-select formControlName="type">
              <mat-option [value]="EmailTypeLvo.PERSONAL">PERSONAL</mat-option>
              <mat-option [value]="EmailTypeLvo.WORK">WORK</mat-option>
            </mat-select>
          </mat-form-field>
        </div>
      </form>

      <form [formGroup]="defaultPhoneForm" class="contact-form">
        <div class="form-row">
          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Phone</mat-label>
            <input matInput formControlName="phone" placeholder="Enter phone">
          </mat-form-field>

          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Phone Type</mat-label>
            <mat-select formControlName="type">
              <mat-option [value]="PhoneTypeLvo.MOBILE">MOBILE</mat-option>
              <mat-option [value]="PhoneTypeLvo.HOME">HOME</mat-option>
              <mat-option [value]="PhoneTypeLvo.WORK">WORK</mat-option>
            </mat-select>
          </mat-form-field>
        </div>
      </form>

      <form [formGroup]="defaultAddressForm" class="contact-form">
        <div class="form-row">
          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Address</mat-label>
            <input matInput formControlName="address" placeholder="Enter address">
          </mat-form-field>

          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Address Type</mat-label>
            <mat-select formControlName="type">
              <mat-option [value]="AddressTypeLvo.HOME">HOME</mat-option>
              <mat-option [value]="AddressTypeLvo.WORK">WORK</mat-option>
            </mat-select>
          </mat-form-field>
        </div>
        <div class="form-row">
          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Country</mat-label>
            <mat-select formControlName="country">
              @for (country of countries; track country) {
              <mat-option [value]="country">{{ country }}</mat-option>
              }
            </mat-select>
            <mat-error *ngIf="mainForm.get('country')?.hasError('required')">
              Country is required
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Region</mat-label>
            <input matInput formControlName="region" placeholder="Enter region" />
          </mat-form-field>

          <mat-form-field appearance="outline" class="form-field">
            <mat-label>City</mat-label>
            <input matInput formControlName="city" placeholder="Enter city" />
          </mat-form-field>
        </div>
      </form>
    </mat-card-content>
  </mat-card>
  }
</div>
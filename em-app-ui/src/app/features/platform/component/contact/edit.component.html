<div class="main-container contact-edit-container">
  <div class="main-header">
    <h1 class="title">
      <mat-icon mat-card-avatar>person</mat-icon>
      @if (isCreateMode) {
      <span>Create Contact</span>
      }
      @if (isEditMode) {
      <span>Edit Contact</span>
      }
      @if (isViewMode) {
      <span>View Contact</span>
      }
    </h1>
    <div class="header-actions">
      <button mat-raised-button (click)="onBack()">
        <mat-icon>arrow_back</mat-icon>
        Back
      </button>

      @if(showCancelButton){
      <button mat-raised-button color="primary" (click)="onCancel()">
        <mat-icon>cancel</mat-icon>
        Cancel
      </button>
      }

      @if(showSaveButton){
      <button mat-raised-button color="primary" (click)="onSave()" [disabled]="pageData.loading() || isInvalidForm">
        <mat-icon>save</mat-icon>
        Save
      </button>
      }

      @if(showCreateButton){
      <button mat-raised-button color="primary" (click)="onCreate()" [disabled]="pageData.loading()">
        <mat-icon>add</mat-icon>
        Create
      </button>
      }

      @if(showEditButton){
      <button mat-raised-button color="primary" (click)="onEdit()" [disabled]="pageData.loading()">
        <mat-icon>edit</mat-icon>
        Edit
      </button>
      }

      @if(showDuplicateButton){
      <button mat-raised-button color="accent" (click)="onDuplicate()" [disabled]="pageData.loading()">
        <mat-icon>content_copy</mat-icon>
        Duplicate
      </button>
      }

      @if(showDeleteButton){
      <button mat-raised-button color="warn" (click)="onDelete()" [disabled]="pageData.loading()">
        <mat-icon>delete</mat-icon>
        Delete
      </button>
      }
    </div>
  </div>

  @if (pageData.error() && !pageData.loading() ) {
  <div class="error-section">
    <mat-card>
      <mat-icon color="warn">error</mat-icon>
      <p>{{ pageData.error() }}</p>
    </mat-card>
  </div>
  }

  @if (pageData.loading()) {
  <div class="loading-section">
    <mat-spinner></mat-spinner>
    <p>Processing...</p>
  </div>
  }@else {

  <mat-card class="form-card form-section">
    <mat-card-content>
      <form [formGroup]="mainForm">
        <!-- Contact Details Section -->
        <div class="form-section">
          <h2 class="section-title">Contact Details</h2>

          <div class="form-row">
            <mat-form-field appearance="outline" class="form-field">
              <mat-label>First Name</mat-label>
              <input matInput formControlName="firstName" placeholder="Enter first name" />
              <mat-error *ngIf="mainForm.get('firstName')?.hasError('required')">
                First name is required
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline" class="form-field">
              <mat-label>Last Name</mat-label>
              <input matInput formControlName="lastName" placeholder="Enter last name" />
              <mat-error *ngIf="mainForm.get('lastName')?.hasError('required')">
                Last name is required
              </mat-error>
            </mat-form-field>
          </div>

          <div class="form-row">
            <mat-form-field appearance="outline" class="form-field">
              <mat-label>Birth Date</mat-label>
              <input matInput type="date" formControlName="birthDate" placeholder="Select birth date" />
            </mat-form-field>

            <mat-form-field appearance="outline" class="form-field">
              <mat-label>Holder Type</mat-label>
              <mat-select formControlName="holderType">
                <mat-option [value]="HolderTypeLvo.ACCOUNT">Account</mat-option>
                <mat-option [value]="HolderTypeLvo.CORPORATE">Corporate</mat-option>
              </mat-select>
              <mat-error *ngIf="mainForm.get('holderType')?.hasError('required')">
                Holder type is required
              </mat-error>
            </mat-form-field>
          </div>
        </div>

        <mat-tab-group mat-stretch-tabs="false" mat-align-tabs="start">
          <mat-tab>
            <ng-template mat-tab-label>
              <mat-icon>email</mat-icon>
              Primary Contact Email
            </ng-template>

            <!-- Email Section -->
            <app-email-list [contact]="dto"></app-email-list>
            <div class="form-section">
              <h2 class="section-title">Email</h2>

              <div class="form-row">
                <mat-form-field appearance="outline" class="form-field">
                  <mat-label>Email Address</mat-label>
                  <input matInput type="email" formControlName="defaultEmail" placeholder="Enter email" />
                  <mat-icon matPrefix>email</mat-icon>
                </mat-form-field>

                <mat-form-field appearance="outline" class="form-field">
                  <mat-label>Email Type</mat-label>
                  <mat-select formControlName="defaultEmailType">
                    <mat-option [value]="EmailTypeLvo.PERSONAL">Personal</mat-option>
                    <mat-option [value]="EmailTypeLvo.WORK">Work</mat-option>
                  </mat-select>
                </mat-form-field>
              </div>
            </div>
          </mat-tab>
          <mat-tab>
            <ng-template mat-tab-label>
              <mat-icon>phone</mat-icon>
              Primary Contact Phone
            </ng-template>
            <!-- Phone Section -->
            <app-phone-list [contact]="dto"></app-phone-list>
            <div class="form-section">
              <h2 class="section-title">Phone</h2>

              <div class="form-row">
                <mat-form-field appearance="outline" class="form-field">
                  <mat-label>Phone Number</mat-label>
                  <input matInput formControlName="defaultPhone" placeholder="Enter phone" />
                  <mat-icon matPrefix>phone</mat-icon>
                </mat-form-field>

                <mat-form-field appearance="outline" class="form-field">
                  <mat-label>Phone Type</mat-label>
                  <mat-select formControlName="defaultPhoneType">
                    <mat-option [value]="PhoneTypeLvo.MOBILE">Mobile</mat-option>
                    <mat-option [value]="PhoneTypeLvo.HOME">Home</mat-option>
                    <mat-option [value]="PhoneTypeLvo.WORK">Work</mat-option>
                  </mat-select>
                </mat-form-field>
              </div>
            </div>
          </mat-tab>
          <mat-tab>
            <ng-template mat-tab-label>
              <mat-icon>location_on</mat-icon>
              Primary Contact Address
            </ng-template>
            <!-- Address Section -->
            <app-address-list [contact]="dto"></app-address-list>
            <div class="form-section">
              <h2 class="section-title">Address</h2>

              <div class="form-row">
                <mat-form-field appearance="outline" class="form-field">
                  <mat-label>Address Type</mat-label>
                  <mat-select formControlName="defaultAddressType">
                    <mat-option [value]="AddressTypeLvo.HOME">Home</mat-option>
                    <mat-option [value]="AddressTypeLvo.WORK">Work</mat-option>
                  </mat-select>
                </mat-form-field>
                <mat-form-field appearance="outline" class="form-field">
                  <mat-label>Address</mat-label>
                  <input matInput formControlName="defaultAddress" placeholder="Enter address" />
                  <mat-icon matPrefix>location_on</mat-icon>
                </mat-form-field>
              </div>

              <div class="form-row">
                <mat-form-field appearance="outline" class="form-field">
                  <mat-label>Country</mat-label>
                  <mat-select formControlName="country">
                    @for (country of countries; track country) {
                    <mat-option [value]="country">{{ country }}</mat-option>
                    }
                  </mat-select>
                  <mat-error *ngIf="mainForm.get('country')?.hasError('required')">
                    Country is required
                  </mat-error>
                </mat-form-field>

                <mat-form-field appearance="outline" class="form-field">
                  <mat-label>Region</mat-label>
                  <input matInput formControlName="region" placeholder="Enter region" />
                </mat-form-field>

                <mat-form-field appearance="outline" class="form-field">
                  <mat-label>City</mat-label>
                  <input matInput formControlName="city" placeholder="Enter city" />
                </mat-form-field>
              </div>
            </div>
          </mat-tab>
        </mat-tab-group>
      </form>
    </mat-card-content>
  </mat-card>
  }
</div>
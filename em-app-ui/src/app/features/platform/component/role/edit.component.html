<div class="main-container role-edit-container">
  <div class="main-header">
    <h1 class="title">
      <mat-icon mat-card-avatar>assignment_ind</mat-icon>
      @if (isCreateMode) {
      <span>Create Role</span>
      }
      @if (isEditMode) {
      <span>Edit Role</span>
      }
      @if (isViewMode) {
      <span>View Role</span>
      }
    </h1>
    <div class="header-actions">
      <button mat-raised-button (click)="onBack()">
        <mat-icon>arrow_back</mat-icon>
        Back
      </button>

      @if(showCancelButton){
      <button mat-raised-button color="primary" (click)="onCancel()">
        <mat-icon>cancel</mat-icon>
        Cancel
      </button>
      }

      @if(showSaveButton){
      <button mat-raised-button color="primary" (click)="onSave()" [disabled]="pageData.loading() || isInvalidForm">
        <mat-icon>save</mat-icon>
        Save
      </button>
      }

      @if(showCreateButton){
      <button mat-raised-button color="primary" (click)="onCreate()" [disabled]="pageData.loading()">
        <mat-icon>add</mat-icon>
        Create
      </button>
      }

      @if(showEditButton){
      <button mat-raised-button color="primary" (click)="onEdit()" [disabled]="pageData.loading()">
        <mat-icon>edit</mat-icon>
        Edit
      </button>
      }

      @if(showDuplicateButton){
      <button mat-raised-button color="accent" (click)="onDuplicate()" [disabled]="pageData.loading()">
        <mat-icon>content_copy</mat-icon>
        Duplicate
      </button>
      }

      @if(showDeleteButton){
      <button mat-raised-button color="warn" (click)="onDelete()" [disabled]="pageData.loading()">
        <mat-icon>delete</mat-icon>
        Delete
      </button>
      }
    </div>
  </div>

  @if (pageData.error() && !pageData.loading()) {
  <div class="error-section">
    <mat-card>
      <mat-icon color="warn">error</mat-icon>
      <p>{{ pageData.error() }}</p>
    </mat-card>
  </div>
  }

  @if (pageData.loading()) {
  <div class="loading-section">
    <mat-spinner></mat-spinner>
    <p>Processing...</p>
  </div>
  }@else{
  <mat-card class="form-card form-section">
    <mat-card-content>
      <form [formGroup]="mainForm">
        <!-- Role Details Section -->
        <div class="form-section">
          <h2 class="section-title">Role Details</h2>
          <div class="form-row">
            <mat-form-field appearance="outline" class="form-field">
              <mat-label>Name</mat-label>
              <input matInput formControlName="name" placeholder="Enter role name" />
              @if(mainForm.get('name')?.hasError('required')) {
              <mat-error>
                Name is required
              </mat-error>
              }
            </mat-form-field>

            <mat-form-field appearance="outline" class="form-field">
              <mat-label>Holder Type</mat-label>
              <mat-select formControlName="holderType">
                <mat-option [value]="HolderTypeLvo.ACCOUNT">Account</mat-option>
                <mat-option [value]="HolderTypeLvo.CORPORATE">Corporate</mat-option>
              </mat-select>
              @if(mainForm.get('holderType')?.hasError('required')) {
              <mat-error>
                Holder type is required
              </mat-error>
              }
            </mat-form-field>
          </div>
          <div class="form-row">
            <mat-form-field appearance="outline" class="form-field">
              <mat-label>Description</mat-label>
              <textarea matInput formControlName="description" placeholder="Enter description" rows="3"></textarea>
            </mat-form-field>
          </div>
        </div>
        <div class="form-section">
          <mat-tab-group mat-stretch-tabs="false" mat-align-tabs="start">
            <mat-tab>
              <ng-template mat-tab-label>
                <mat-icon>security</mat-icon>
                Privileges
              </ng-template>
              @if(isCreateMode || isEditMode) {
              <mat-tab-group mat-stretch-tabs="false" mat-align-tabs="start">
                <mat-tab>
                  <ng-template mat-tab-label>
                    <mat-icon>security</mat-icon>
                    Assigned Privileges
                  </ng-template>
                  <app-role-privilege-assigned-list [dto]="dto"
                    (onPrivilegeRemoved)="privilegeRemoved($event)"></app-role-privilege-assigned-list>
                </mat-tab>
                <mat-tab>
                  <ng-template mat-tab-label>
                    <mat-icon>add</mat-icon>
                    Assign new Privileges
                  </ng-template>
                  <app-role-privilege-assign-list [dto]="dto"></app-role-privilege-assign-list>
                </mat-tab>
              </mat-tab-group>
              }@else {
              <app-role-privilege-assigned-list [dto]="dto"></app-role-privilege-assigned-list>
              }
            </mat-tab>
            <mat-tab>
              <ng-template mat-tab-label>
                <mat-icon>people</mat-icon>
                Users
              </ng-template>
              @if(isCreateMode || isEditMode) {
              <mat-tab-group mat-stretch-tabs="false" mat-align-tabs="start">
                <mat-tab>
                  <ng-template mat-tab-label>
                    <mat-icon>security</mat-icon>
                    Assigned Users
                  </ng-template>
                  <app-role-user-assigned-list [dto]="dto"
                    (onUserRemoved)="userRemoved($event)"></app-role-user-assigned-list>
                </mat-tab>
                <mat-tab>
                  <ng-template mat-tab-label>
                    <mat-icon>add</mat-icon>
                    Assign new Users
                  </ng-template>
                  <app-role-user-assign-list [dto]="dto"></app-role-user-assign-list>
                </mat-tab>
              </mat-tab-group>
              }@else {
              <app-role-user-assigned-list [dto]="dto"></app-role-user-assigned-list>
              }
            </mat-tab>
          </mat-tab-group>
        </div>
      </form>
    </mat-card-content>
  </mat-card>
  }
</div>
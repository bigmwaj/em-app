<div class="main-container group-edit-container">
  <div class="main-header">
    <h1 class="title">
      <mat-icon mat-card-avatar>group</mat-icon>
      @if (isCreateMode) {
      <span>Create Group</span>
      }
      @if (isEditMode) {
      <span>Edit Group</span>
      }
      @if (isViewMode) {
      <span>View Group</span>
      }
    </h1>
    <div class="header-actions">
      <button mat-raised-button (click)="onBack()">
        <mat-icon>arrow_back</mat-icon>
        Back
      </button>

      @if(showCancelButton){
      <button mat-raised-button color="primary" (click)="onCancel()">
        <mat-icon>cancel</mat-icon>
        Cancel
      </button>
      }

      @if(showSaveButton){
      <button mat-raised-button color="primary" (click)="onSave()" [disabled]="pageData.loading() || isInvalidForm">
        <mat-icon>save</mat-icon>
        Save
      </button>
      }

      @if(showCreateButton){
      <button mat-raised-button color="primary" (click)="onCreate()" [disabled]="pageData.loading()">
        <mat-icon>add</mat-icon>
        Create
      </button>
      }

      @if(showEditButton){
      <button mat-raised-button color="primary" (click)="onEdit()" [disabled]="pageData.loading()">
        <mat-icon>edit</mat-icon>
        Edit
      </button>
      }

      @if(showDuplicateButton){
      <button mat-raised-button color="accent" (click)="onDuplicate()" [disabled]="pageData.loading()">
        <mat-icon>content_copy</mat-icon>
        Duplicate
      </button>
      }

      @if(showDeleteButton){
      <button mat-raised-button color="warn" (click)="onDelete()" [disabled]="pageData.loading()">
        <mat-icon>delete</mat-icon>
        Delete
      </button>
      }
    </div>
  </div>

  <app-message [pageData]="pageData"></app-message>

  @if (pageData.loading()) {
  <div class="loading-section">
    <mat-spinner></mat-spinner>
    <p>Processing...</p>
  </div>
  } @else {
  <mat-card class="form-card form-section">
    <mat-card-content>
      <form [formGroup]="mainForm">
        <!-- Group Details Section -->
        <div class="form-section">
          <h2 class="section-title">Group Details</h2>

          <div class="form-row">
            <mat-form-field appearance="outline" class="form-field">
              <mat-label>Name</mat-label>
              <input matInput formControlName="name" placeholder="Enter group name" />
              @if(mainForm.get('name')?.hasError('required')) {
              <mat-error>
                Name is required
              </mat-error>
              }
            </mat-form-field>

            <mat-form-field appearance="outline" class="form-field">
              <mat-label>Holder Type</mat-label>
              <mat-select formControlName="ownerType">
                <mat-option [value]="OwnerTypeLvo.ACCOUNT">Account</mat-option>
                <mat-option [value]="OwnerTypeLvo.CORPORATE">Corporate</mat-option>
              </mat-select>
              @if(mainForm.get('ownerType')?.hasError('required')) {
              <mat-error>
                Holder type is required
              </mat-error>
              }
            </mat-form-field>
          </div>

          <div class="form-row">
            <mat-form-field appearance="outline" class="form-field-full">
              <mat-label>Description</mat-label>
              <textarea matInput formControlName="description" placeholder="Enter description" rows="3"></textarea>
            </mat-form-field>
          </div>
        </div>

        <div class="form-section">
          <mat-tab-group mat-stretch-tabs="false" mat-align-tabs="start">
            <mat-tab>
              <ng-template mat-tab-label>
                <mat-icon>security</mat-icon>
                roles
              </ng-template>
              @if(isCreateMode || isEditMode) {
              <mat-tab-group mat-stretch-tabs="false" mat-align-tabs="start">
                <mat-tab>
                  <ng-template mat-tab-label>
                    <mat-icon>security</mat-icon>
                    Assigned roles
                  </ng-template>
                  <app-group-role-assigned-list [dto]="dto" [isViewMode]="isViewMode"
                    (onRoleRemoved)="roleRemoved($event)"></app-group-role-assigned-list>
                </mat-tab>
                <mat-tab>
                  <ng-template mat-tab-label>
                    <mat-icon>add</mat-icon>
                    Assign new roles
                  </ng-template>
                  <app-group-role-assign-list [dto]="dto"></app-group-role-assign-list>
                </mat-tab>
              </mat-tab-group>
              }@else {
              <app-group-role-assigned-list [dto]="dto" [isViewMode]="isViewMode"></app-group-role-assigned-list>
              }
            </mat-tab>
            <mat-tab>
              <ng-template mat-tab-label>
                <mat-icon>people</mat-icon>
                Users
              </ng-template>
              @if(isCreateMode || isEditMode) {
              <mat-tab-group mat-stretch-tabs="false" mat-align-tabs="start">
                <mat-tab>
                  <ng-template mat-tab-label>
                    <mat-icon>security</mat-icon>
                    Assigned Users
                  </ng-template>
                  <app-shared-user-assigned-list [ownerId]="dto?.id" [isViewMode]="isViewMode"
                    [searchEndPoint]="searchGroupUsersEndPoint" (onUserRemoved)="userRemoved($event)">
                  </app-shared-user-assigned-list>
                </mat-tab>
                <mat-tab>
                  <ng-template mat-tab-label>
                    <mat-icon>add</mat-icon>
                    Assign new Users
                  </ng-template>
                  <app-shared-user-assign-list [ownerId]="dto?.id"></app-shared-user-assign-list>
                </mat-tab>
              </mat-tab-group>
              }@else {
              <app-shared-user-assigned-list [ownerId]="dto?.id" [isViewMode]="isViewMode"
                [searchEndPoint]="searchGroupUsersEndPoint">
              </app-shared-user-assigned-list>
              }
            </mat-tab>
          </mat-tab-group>
        </div>
      </form>
    </mat-card-content>
  </mat-card>

  }
</div>